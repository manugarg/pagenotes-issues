{{ define "main" }}
<style>
  .faq-hero {
    background: linear-gradient(135deg, #1E3A5F, #2563EB, #6366F1);
    color: white;
    padding: 3rem 1.5rem;
    border-radius: 0.75rem;
    margin-bottom: 2rem;
    text-align: center;
  }
  .faq-hero h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }
  .faq-hero p {
    opacity: 0.9;
    font-size: 1.125rem;
    max-width: 600px;
    margin: 0 auto;
  }
  .faq-search {
    max-width: 480px;
    margin: 1.5rem auto 0;
    position: relative;
  }
  .faq-search input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.75rem;
    border-radius: 9999px;
    border: none;
    font-size: 1rem;
    outline: none;
    color: #1f2937;
  }
  .faq-search input::placeholder {
    color: #9ca3af;
  }
  .faq-search svg {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    color: #9ca3af;
  }
  .faq-toc {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    padding: 1.5rem 2rem;
    margin-bottom: 2rem;
  }
  .faq-toc h2 {
    font-size: 1rem;
    font-weight: 600;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 1rem;
  }
  .faq-toc ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  .faq-toc li {
    flex-shrink: 0;
  }
  @media (max-width: 768px) {
    .faq-toc a {
      white-space: normal;
    }
    .faq-toc {
      padding: 1rem 1.25rem;
    }
    .faq-item-header {
      padding: 1rem;
    }
    .faq-item-content {
      padding: 0 1rem 1rem;
    }
  }
  @media (max-width: 768px) {
    .faq-hero h1 {
      font-size: 1.75rem;
    }
  }
  .faq-toc a {
    display: inline-block;
    padding: 0.4rem 0.875rem;
    border-radius: 9999px;
    color: #2563EB;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.9rem;
    background: #EFF6FF;
    border: 1px solid #DBEAFE;
    transition: background 0.15s ease, border-color 0.15s ease;
  }
  .faq-toc a:hover {
    background: #DBEAFE;
    border-color: #93C5FD;
  }
  .faq-item {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    margin-bottom: 1rem;
    overflow: hidden;
    transition: box-shadow 0.2s ease;
  }
  .faq-item:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
  }
  .faq-item-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.25rem 1.5rem;
    cursor: pointer;
    user-select: none;
    gap: 1rem;
  }
  .faq-item-header h3 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1f2937;
    margin: 0;
  }
  .faq-item-header h3 a {
    color: inherit;
    text-decoration: none;
  }
  .faq-item-header h3 a:hover {
    color: #2563EB;
  }
  .faq-chevron {
    width: 20px;
    height: 20px;
    color: #9ca3af;
    transition: transform 0.25s ease;
    flex-shrink: 0;
  }
  .faq-item.open .faq-chevron {
    transform: rotate(180deg);
  }
  .faq-item-body {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.35s ease;
  }
  .faq-item.open .faq-item-body {
    max-height: 2000px;
  }
  .faq-item-content {
    padding: 0 1.5rem 1.5rem;
    border-top: 1px solid #f3f4f6;
    padding-top: 1rem;
    color: #4b5563;
    line-height: 1.7;
  }
  .faq-item-content a {
    color: #2563EB;
    text-decoration: underline;
    text-underline-offset: 2px;
  }
  .faq-item-content a:hover {
    color: #1D4ED8;
  }
  .faq-screenshots-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    margin-top: 0.75rem;
    font-size: 0.875rem;
    color: #2563EB;
    text-decoration: none !important;
    font-weight: 500;
  }
  .faq-screenshots-link:hover {
    text-decoration: underline !important;
  }
  /* Anchor offset for sticky header */
  .faq-item[id]::before {
    content: '';
    display: block;
    height: 5rem;
    margin: -5rem 0 0;
  }
  .faq-no-results {
    text-align: center;
    padding: 3rem 1rem;
    color: #6b7280;
    display: none;
  }
  .faq-item-content pre {
    overflow-x: auto;
    max-width: 100%;
  }
  .faq-item-content img {
    max-width: 100%;
    height: auto;
  }
</style>

<div class="content-wrapper">
{{ partial "header/my-header.html" . }}

<!-- FAQ Hero -->
<div class="faq-hero">
  <h1>{{ .Title }}</h1>
  <p>Quick answers to common questions about PageNotes</p>
  <div class="faq-search">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
    </svg>
    <input type="text" id="faq-search-input" placeholder="Search FAQs..." autocomplete="off">
  </div>
</div>

{{ .Content }}

<!-- Table of Contents -->
<nav class="faq-toc" id="faq-toc" aria-label="Table of Contents">
  <h2>Quick Links</h2>
  <ul>
    {{ range .Pages }}
      <li><a href="#{{ .RelPermalink | path.Base }}" onclick="openFaqById('{{ .RelPermalink | path.Base }}')">{{ .Title }}</a></li>
    {{ end }}
  </ul>
</nav>

<!-- Expand/Collapse toggle -->
<div style="text-align: right; margin-bottom: 0.75rem;">
  <button id="expand-all-btn" onclick="toggleExpandAll()" style="background: none; border: 1px solid #d1d5db; border-radius: 0.5rem; padding: 0.4rem 1rem; font-size: 0.875rem; font-weight: 500; color: #4b5563; cursor: pointer;">Expand All</button>
</div>

<!-- FAQ Items -->
<div id="faq-list">
  {{ range .Pages }}
  <section class="faq-item" id="{{ .RelPermalink | path.Base }}" data-title="{{ .Title | lower }}">
    <div class="faq-item-header" onclick="toggleFaq(this)">
      <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
      <svg class="faq-chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
      </svg>
    </div>
    <div class="faq-item-body">
      <div class="faq-item-content">
        {{ .Content }}
        {{ if .Params.screenshots }}
        <a class="faq-screenshots-link" href="{{ .RelPermalink }}">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909M3.75 21h16.5A2.25 2.25 0 0 0 22.5 18.75V5.25A2.25 2.25 0 0 0 20.25 3H3.75A2.25 2.25 0 0 0 1.5 5.25v13.5A2.25 2.25 0 0 0 3.75 21Z" /></svg>
          View screenshots
        </a>
        {{ end }}
      </div>
    </div>
  </section>
  {{ end }}
</div>

<div class="faq-no-results" id="faq-no-results">
  <p style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">No matching questions found</p>
  <p>Try a different search term or <a href="https://github.com/manugarg/pagenotes-issues/discussions" style="color: #2563EB;">ask in our community</a>.</p>
</div>

</div>

<script>
var allExpanded = false;

function toggleFaq(header) {
  var item = header.parentElement;
  item.classList.toggle('open');
  updateExpandButton();
}

function toggleExpandAll() {
  var items = document.querySelectorAll('.faq-item');
  allExpanded = !allExpanded;
  items.forEach(function(item) {
    if (allExpanded) {
      item.classList.add('open');
    } else {
      item.classList.remove('open');
    }
  });
  updateExpandButton();
}

function updateExpandButton() {
  var btn = document.getElementById('expand-all-btn');
  var items = document.querySelectorAll('.faq-item');
  var openCount = document.querySelectorAll('.faq-item.open').length;
  allExpanded = openCount === items.length;
  btn.textContent = allExpanded ? 'Collapse All' : 'Expand All';
}

function openFaqById(id) {
  // Close all other FAQ items
  document.querySelectorAll('.faq-item.open').forEach(function(item) {
    item.classList.remove('open');
  });
  var target = document.getElementById(id);
  if (target && target.classList.contains('faq-item')) {
    target.classList.add('open');
  }
}

// Open FAQ item if navigated to via anchor
(function() {
  if (window.location.hash) {
    openFaqById(window.location.hash.substring(1));
  }
})();

// FAQ search/filter
(function() {
  var input = document.getElementById('faq-search-input');
  var items = document.querySelectorAll('.faq-item');
  var toc = document.getElementById('faq-toc');
  var noResults = document.getElementById('faq-no-results');

  input.addEventListener('input', function() {
    var query = this.value.toLowerCase().trim();
    var visibleCount = 0;

    items.forEach(function(item) {
      var title = item.getAttribute('data-title') || '';
      var content = item.textContent.toLowerCase();
      var match = !query || title.indexOf(query) !== -1 || content.indexOf(query) !== -1;
      item.style.display = match ? '' : 'none';
      if (match) {
        visibleCount++;
        if (query) {
          item.classList.add('open');
        }
      } else {
        item.classList.remove('open');
      }
    });

    // Collapse all when search is cleared
    if (!query) {
      items.forEach(function(item) { item.classList.remove('open'); });
    }

    toc.style.display = query ? 'none' : '';
    noResults.style.display = visibleCount === 0 ? 'block' : 'none';
  });
})();
</script>
{{ end }}
